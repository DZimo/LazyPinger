<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:LazyPingerMAUI.Views"
             xmlns:vm="clr-namespace:LazyPingerMAUI.ViewModels"
             xmlns:models="clr-namespace:LazyPinger.Base.Models;assembly=LazyPinger.Base"
             xmlns:vmcore="clr-namespace:LazyPinger.Core.ViewModels;assembly=LazyPinger.Core"
             xmlns:strings="clr-namespace:LazyPinger.Base.Localization;assembly=LazyPinger.Base"
             x:Class="LazyPingerMAUI.Views.SettingsPage"
             Background="{AppThemeBinding Light={StaticResource WhiteGradient}, Dark={StaticResource GreyGradient}}"
             x:DataType="vm:SettingsViewModel">

    <Grid RowDefinitions="125, *">

        <ContentView ControlTemplate="{StaticResource LazyPingerHeader}"
                     BindingContext="{Binding MainVm.SloganRandomText}"/>

        <ScrollView Grid.Row="1" Margin="0, 25, 0, 0">

            <Grid RowDefinitions="Auto, *" 
                      ColumnDefinitions="*, *" 
                      HorizontalOptions="Center">

                <!-- User Selection -->

                <FlexLayout   Direction="Column"
                                  JustifyContent="Center"
                                  Grid.Row="0"
                                  Grid.Column="0"
                                  Grid.ColumnSpan="2"
                                  AlignItems="Stretch"
                                  Margin="20">

                    <Border Stroke="{StaticResource Primary}">
                        <VerticalStackLayout Margin="20">
                            <Label Style="{StaticResource SubHeadlineAlternative}">Set your settings</Label>

                            <HorizontalStackLayout VerticalOptions="Center" HorizontalOptions="Center">
                                <HorizontalStackLayout Margin="0, 20, 0, 20">
                                    <Label VerticalOptions="Center" Margin="0, 0, 20, 0" Text="Auto Run"/>
                                    <CheckBox VerticalOptions="Center" IsChecked="{Binding UserSelectionsVm.IsAutoRunEnabled, Source={x:Static vmcore:ListenVm.Instance}}"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Margin="0, 20, 0, 20" >
                                    <Label VerticalOptions="Center" Margin="0, 0, 20, 0" Text="Fast Ping"/>
                                    <CheckBox VerticalOptions="Center" IsChecked="{Binding UserSelectionsVm.IsFastPingEnabled, Source={x:Static vmcore:ListenVm.Instance}}"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Margin="0, 20, 0, 20">
                                    <Label VerticalOptions="Center" Margin="0, 0, 20, 0" Text="Auto Restart"/>
                                    <CheckBox VerticalOptions="Center" IsChecked="{Binding UserSelectionsVm.IsAutoRestartEnabled, Source={x:Static vmcore:ListenVm.Instance}}"/>
                                </HorizontalStackLayout>
                            </HorizontalStackLayout>

                            <Button Margin="20" 
                                        MaximumWidthRequest="400" 
                                        Command="{Binding ApplyUserSelectionCommand}" 
                                        Text="Apply"/>

                        </VerticalStackLayout>
                    </Border>
                </FlexLayout>

                <!-- Device Ping  -->

                <Border    Grid.Row="1"
                               Grid.Column="0" 
                               Margin="20"
                               Stroke="{StaticResource Primary}">

                    <FlexLayout Direction="Column"
                                JustifyContent="Center"
                                AlignItems="Stretch">

                        <Label Margin="5" Style="{StaticResource SubHeadlineAlternative}" Text="New Device"></Label>

                        <StackLayout FlexLayout.Grow="1" VerticalOptions="Center" HorizontalOptions="Fill">
                            <Label Margin="20, 0, 10, 10" Text="Name"/>
                            <Entry Margin="20, 0, 10, 10" Text="{Binding DevicePingTemp.Name}"/>
                        </StackLayout>
                        <StackLayout VerticalOptions="Center" HorizontalOptions="Fill">
                            <Label Margin="20, 0, 10, 10" Text="Image"/>
                            <Picker Margin="20, 0, 10, 10"  
                                        ItemsSource="{Binding MainVm.ExistingImages}" 
                                        SelectedItem="{Binding DevicePingTemp.Image}"/>
                        </StackLayout>
                        <StackLayout VerticalOptions="Center" HorizontalOptions="Fill">
                            <Label Margin="20, 0, 10, 10" Text="Device Group"/>
                            <Picker Margin="20, 0, 10, 10" 
                                    ItemDisplayBinding="{Binding Type}"
                                    ItemsSource="{Binding DevicesGroupVm, Source={x:Static vmcore:ListenVm.Instance}}"
                                    SelectedItem="{Binding VmDeviceGroupTemp}">   
                            </Picker>
                        </StackLayout>
                        <StackLayout>
                            <Label Margin="20, 0, 10, 10" HorizontalOptions="Center" Text="Classify by IP or Range"/>

                            <StackLayout IsVisible="{Binding IsIpBased}" VerticalOptions="Center" HorizontalOptions="Fill">
                                <Entry Margin="20, 0, 10, 10" Placeholder="IP" Text="{Binding DevicePingTemp.IP}"/>
                            </StackLayout>

                            <Grid IsVisible="{Binding IsIpBased, Converter={StaticResource IsValidConverter}}" ColumnDefinitions="*,*" HorizontalOptions="Fill">

                                <Entry Grid.Column="0" 
                                       Margin="20, 0, 10, 10" 
                                       Placeholder="Range Min"
                                       Text="{Binding DevicePingTemp.SubnetRangeMin}"/>

                                <Entry Grid.Column="1" 
                                       Margin="20, 0, 10, 10" 
                                       Placeholder="Range Max"
                                       Text="{Binding DevicePingTemp.SubnetRangeMax}"/>
                            </Grid>
                            <HorizontalStackLayout HorizontalOptions="Center" >
                                <RadioButton Margin="10" IsChecked="{Binding IsIpBased}" Content="IP"/>
                                <RadioButton Margin="10" Content="Range"/>
                            </HorizontalStackLayout>
                        </StackLayout>
                        <Button Margin="20, 0, 10, 10" 
                                    Text="Create"
                                    IsEnabled="{Binding CanCreateDevice}"
                                    MaximumWidthRequest="400"
                                    Command="{Binding CreateNewDeviceCommand}"/>
                    </FlexLayout>
                </Border>

                <!-- Device Group -->

                <Border Stroke="{StaticResource Primary}"
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="20">

                    <FlexLayout Direction="Column"
                                JustifyContent="Center"
                                AlignItems="Stretch">

                        <Label Margin="5 ,10 " Style="{StaticResource SubHeadlineAlternative}" Text="New Device Group"></Label>

                        <StackLayout FlexLayout.Grow="1" 
                                         VerticalOptions="Center" 
                                         HorizontalOptions="Fill">
                            <Label Margin="20, 0, 10, 5" 
                                       Text="Type"/>

                            <Entry Margin="20, 0, 10, 5"  Text="{Binding DeviceGroupTemp.Type}"/>
                        </StackLayout>
                        <StackLayout  FlexLayout.Grow="1" 
                                          VerticalOptions="Center" 
                                          HorizontalOptions="Fill">
                            <Label  Margin="20, 0, 10, 5" Text="Color"/>
                            <Picker ItemsSource="{Binding MainVm.ExistingColors}" 
                                        SelectedItem="{Binding DeviceGroupTemp.Color}" 
                                        Margin="20, 0, 10, 5"/>
                        </StackLayout>

                        <Button Margin="20, 0, 10, 5"
                                    MaximumWidthRequest="400" 
                                    IsEnabled="{Binding CanCreateDeviceGroup}"
                                    Command="{Binding CreateNewDeviceGroupCommand}"
                                    Text="Create">
                        </Button>
                    </FlexLayout>
                </Border>

            </Grid>
            </ScrollView>
        
    </Grid>

</ContentPage>
